// ==UserScript==
// @name          Junker
// @author        SkidLamer <skidlamer@mail.com>
// @source        https://github.com/e9x/kru
// @version       1.0
// @license       BSD-3-Clause
// @namespace     https://skidlamer.github.io/
// @supportURL    https://e9x.github.io/kru/inv/
// @extracted     Sun, 09 May 2021 19:45:55 GMT
// @include       /^https?:\/\/(internal\.|comp\.)?krunker\.io\/*?(index.html)?(\?|$)/
// @run-at        document-start
// @grant         none
// @connect       sys32.dev
// @connect       githubusercontent.com
// ==/UserScript==
// For any concerns regarding minified code, you are encouraged to build from the source
// For license information please see https://raw.githubusercontent.com/e9x/kru/master/junker.user.js.LICENSE.txt

// Donations Accepted
// BTC:  3CsDVq96KgmyPjktUe1YgVSurJVe7LT53G
// ETH:  0x5dbF713F95F7777c84e6EFF5080e2f0e0724E8b1
// ETC:  0xF59BEbe25ECe2ac3373477B5067E07F2284C70f3
// Amazon Giftcard - skidlamer@mail.com

(()=>{var t={672:(t,e,s)=>{var i=s(283),a=(t,e)=>new URL("v"+t+"/"+e,i.api_url);e.token=async()=>{var t=await(await fetch(a(1,"key"))).text(),s=await(await fetch("https://matchmaker.krunker.io/generate-token",{headers:{"client-key":t}})).json();return await(await fetch(a(1,"token"),{method:"POST",headers:{"content-type":"application/json","x-media":e.w},body:JSON.stringify(s)})).json()},e.init=t=>(e.w="","646973636f72642c676974687562".replace(/../g,(t=>e.w+=String.fromCharCode(parseInt(t,16)))),e.w="junker,"+e.w.split(",").map((t=>i[t]))+","+t.discord.code,e),e.source=()=>i.request(a(1,"source"))},283:(t,e)=>{"use strict";var s={get_value:"function"==typeof GM_getValue&&GM_getValue,set_value:"function"==typeof GM_setValue&&GM_setValue,request:"function"==typeof GM_xmlhttpRequest&&GM_xmlhttpRequest,client_fetch:"function"==typeof GM_client_fetch&&GM_client_fetch,fetch:window.fetch.bind(window)};e.script="https://raw.githubusercontent.com/e9x/kru/master/junker.user.js",e.github="https://github.com/e9x/kru",e.discord="https://e9x.github.io/kru/invite",e.extracted="number"!=typeof 1620589555082?Date.now():1620589555082,e.store={get:async t=>s.get_value?await s.get_value(t):localStorage.getItem("ss"+t),set:(t,e)=>s.set_value?s.set_value(t,e):localStorage.setItem("ss"+t,e),del(t){s.get_value?this.set(t,""):localStorage.removeItem("ss"+t)}},e.request=(t,e={})=>new Promise(((i,a)=>{t=new URL(t,location),s.request?s.request({url:t.href,headers:e,onerror:a,onload:t=>i(t.responseText)}):s.fetch(t,{headers:e}).then((t=>t.text())).then(i).catch(a)})),e.add_ele=(t,e,s)=>Object.assign(e.appendChild(document.createElement(t)),s),e.crt_ele=(t,e)=>Object.assign(document.createElement(t),e),e.string_key=t=>t.replace(/^(Key|Digit|Numpad)/,""),e.api_url="https://sys32.dev/api/"},579:(t,e,s)=>{var i=s(283),a=async()=>i.request(i.script).then((t=>{if(i.extracted>=new Date((e=t,s={},e.replace(/\/\/ ==UserScript==\n([\s\S]*?)\n\/\/ ==\/UserScript==/,((t,e)=>e.split("\n").forEach((t=>t.replace(/@(\S+)\s+(.*)/,((t,e,i)=>s[e]=e in s?[].concat(s[e],i):i)))))),s).extracted).getTime())return setTimeout(a,18e4);var e,s;confirm("A new Junker version is available, do you wish to update?")&&location.assign(i.script)})).catch(console.error);window.addEventListener("load",a)},142:function(t,e){e.head=document.head||document.getElementsByTagName("head")[0]||document.documentElement,e.isType=(t,e)=>typeof t===e,e.isDefined=t=>!e.isType(t,"undefined")&&null!==t,e.isURL=t=>/^https?:\/\/(?:www\.)?[-a-zA-Z0-9@:%._\+~#=]{1,256}\.[a-zA-Z0-9()]{1,6}\b([-a-zA-Z0-9()@:%_\+.~#?&//=]*)$/gm.test(t),e.objectHas=(t,e)=>e.some((e=>t.hasOwnProperty(e))),e.genHash=t=>[...Array(t)].map((t=>"abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[~~(52*Math.random())])).join(""),e.loadScript=t=>{try{var s=null;e.isType(t,"string")?e.isURL(t)?e.request(t,"text",{cache:"no-store"}).then((t=>e.loadScript(t))):(s=document.createElement("script")).appendChild(document.createTextNode(t)):e.isType(t,"function")&&((s=document.createElement("script")).textContent=`try {(${t})()}catch(e){console.error(e)}`),s&&e.head.appendChild(s)}catch(t){console.error(t)}s&&s.parentNode&&s.parentNode.removeChild(s),s&&s.hasAttribute("textContent")&&s.removeAttribute("textContent")},e.loadStyle=t=>{let s=document.createElement("link");return s.rel="stylesheet",s.type="text/css",s.href=t,e.head.appendChild(s)},e.loadFrame=t=>{let s=document.createElement("iframe");return Object.entries(t).forEach((([t,e],i)=>{s.setAttribute(t,...e)})),e.head.appendChild(s)},e.patchData=(t,e)=>{for(let s in e){let i=e[s];i.regex.exec(t)?(t=t.replace(i.regex,i.patch),console.info("Patched ",s)):alert("Failed to Patch "+s)}return t},e.getData=(t,e)=>{let s={};for(let i in e){let a=e[i],n=a.regex.exec(t);a.hasOwnProperty("index")&&(n?(a.val=n[a.index],console.info("Found ",i,":",a)):(a.val=null,alert("Failed to Find "+i)),Object.defineProperty(s,i,{configurable:!1,value:a.val}))}return s},e.saveData=(t,e)=>{let s=new Blob([e],{type:"text/plain"}),i=window.document.createElement("a");i.href=window.URL.createObjectURL(s),i.download=t,window.document.body.appendChild(i),i.click(),window.document.body.removeChild(i)},e.createObserver=(t,e,s,i=!0)=>new MutationObserver(((t,a)=>{("src"==e||i&&"block"==t[0].target.style.display||!i)&&s(t[0].target)})).observe(t,"childList"==e?{childList:!0}:{attributes:!0,attributeFilter:[e]}),e.createElement=(t,s,i)=>{if(!e.isDefined(t))return null;e.isDefined(i)||(i="");let a=document.createElement(t);if(e.isType(s,"object"))for(let t in s)a.setAttribute(t,s[t]);Array.isArray(i)||(i=[i]);for(let t=0;t<i.length;t++)i[t].tagName?a.appendChild(i[t]):a.appendChild(document.createTextNode(i[t]));return a},e.createButton=(t,s,i,a)=>{a=a?"inherit":"none",e.waitFor((t=>document.querySelector("#menuItemContainer"))).then((i=>{let n=e.createElement("div",{class:"menuItemIcon",style:`background-image:url("${s}");display:inherit;`}),o=e.createElement("div",{class:"menuItemTitle",style:"display:inherit;"},t),r=e.createElement("div",{id:"mainButton",class:"menuItem",onmouseenter:"playTick()",onclick:"showWindow(12)",style:`display:${a};`},[n,o]);i&&i.append(r)}))},e.request=async(t,e,s={})=>{const i=await fetch(t,s);return i.ok?i[e]():this.nin.request(t,e,s)},e.waitFor=async(t,e=1/0,s=null)=>{let i=t=>new Promise((e=>setTimeout(e,t)));return new Promise((async(a,n)=>{let o;for("number"!=typeof e&&n("Timeout argument not a number in waitFor(selector, timeout_ms)");void 0===o||!1===o||null===o||0===o.length;){if(s&&s instanceof Function&&s(),e%1e4<100&&console.log("waiting for: ",t),(e-=100)<0)return console.error("Timeout : ",t),void a(!1);await i(100),o="string"==typeof t?Function(t)():t()}console.info("Passed : ",t),a(o)}))}}},e={};function s(i){var a=e[i];if(void 0!==a)return a.exports;var n=e[i]={exports:{}};return t[i].call(n.exports,n,n.exports,s),n.exports}s.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),(()=>{"use strict";s(283);var t=s(672),e=s(142),i=CanvasRenderingContext2D.prototype;s(579);var a=new class{constructor(){this.hash=e.genHash(8),s.g[this.hash]=this,this.settings=null,this.css={hideAdverts:"#aContainer, #aHolder, #endAContainer, #aMerger { display: none !important; }",noTextShadows:"*, .button.small, .bigShadowT { text-shadow: none !important; }"},this.tabs=["Render","Weapon","Player","GamePlay","Radio","Dev"],this.downKeys=new Set,this.nameTags=void 0,this.consts={twoPI:2*Math.PI,halfPI:Math.PI/2,playerHeight:11,cameraHeight:1.5,headScale:2,armScale:1.3,armInset:.1,chestWidth:2.6,hitBoxPad:1,crouchDst:3,recoilMlt:.3,nameOffset:.6,nameOffsetHat:.8},this.key={frame:0,delta:1,xdir:2,ydir:3,moveDir:4,shoot:5,scope:6,jump:7,reload:8,crouch:9,weaponScroll:10,weaponSwap:11,moveLock:12},this.eventHandlers(),this.discord={code:"ddU4UzWFKb"},e.request("https://discordapp.com/api/v6/invite/"+this.discord.code+"?with_counts=true","json",{cache:"no-store"}).then((t=>{Object.assign(this.discord,t)})),e.waitFor((()=>this.token)).then((()=>{this.gameLoad(),this.createSettings(),this.gameHooks()}))}onInput(t){if(!this.settings||!e.isDefined(this.me))return t;let s=e.isDefined(this.me.weapon.melee)&&this.me.weapon.melee||e.isDefined(this.me.weapon.canThrow)&&this.me.weapon.canThrow,i=this.me[this.vars.ammos][this.me[this.vars.weaponIndex]];if(this.settings.autoReload.val&&(s?this.me.canThrow:i||(this.game.players.reload(this.me),t[this.key.reload]=1)),this.settings.autoBhop.val&&"off"!==this.settings.autoBhop.val&&(this.downKeys.has("Space")||"autoJump"==this.settings.autoBhop.val||"autoSlide"==this.settings.autoBhop.val)&&(this.controls.keys[this.controls.binds.jump.val]^=1,this.controls.keys[this.controls.binds.jump.val]&&(this.controls.didPressed[this.controls.binds.jump.val]=1),(this.downKeys.has("Space")||"autoSlide"==this.settings.autoBhop.val)&&this.me[this.vars.yVel]<-.03&&this.me.canSlide&&(setTimeout((()=>{this.controls.keys[this.controls.binds.crouch.val]=0}),this.me.slideTimer||325),this.controls.keys[this.controls.binds.crouch.val]=1,this.controls.didPressed[this.controls.binds.crouch.val]=1)),"off"!==this.settings.autoAim.val){this.ray.setFromCamera(this.vec2,this.renderer.fpsCamera);const e=[];let a=null,n=this.game.players.list.filter((t=>{let s=void 0!==t[this.vars.objInstances]&&t[this.vars.objInstances]&&!t[this.vars.isYou]&&!this.getIsFriendly(t)&&t.health>0&&this.getInView(t);return s&&e.push(t[this.vars.objInstances]),s}));if("off"!==this.settings.fovBoxSize.val){let t=this.ctx.canvas.width/this.scale,e=this.ctx.canvas.height/this.scale;for(let s=0;s<n.length;s++){const i=n[s],o=this.world2Screen(new this.three.Vector3(i.x,i.y,i.z),t,e,i.height/2);let r=null;switch(this.settings.fovBoxSize.val){case"large":r=[t/3,e/4,t*(1/3),e/2];break;case"medium":r=[.4*t,e/3,.2*t,e/3];break;case"small":r=[.45*t,.4*e,.1*t,.2*e]}if(o.x>=r[0]&&o.x<=r[0]+r[2]&&o.y>=r[1]&&o.y<r[1]+r[3]){a=n[s];break}}}else a=n.sort(((t,e)=>this.getD3D(this.me.x,this.me.z,t.x,t.z)-this.getD3D(this.me.x,this.me.z,e.x,e.z))).shift();if(a){let n=a[this.vars.objInstances].position.clone(),o=1e3*(this.getDir(this.me.z,this.me.x,n.z||a.z,n.x||a.x)||0),r=1e3*((this.getXDire(this.me.x,this.me.y,this.me.z,n.x||a.x,n.y||a.y-a[this.vars.crouchVal]*this.consts.crouchDst+this.me[this.vars.crouchVal]*this.consts.crouchDst+this.settings.aimOffset.val,n.z||a.z)||0)-this.consts.recoilMlt*this.me[this.vars.recoilAnimY]),l=this.ray.intersectObjects(e,!0).length,h=n.clone();h.y+=this.consts.playerHeight+this.consts.nameOffset-a[this.vars.crouchVal]*this.consts.crouchDst,a.hatIndex>=0&&(h.y+=this.consts.nameOffsetHat);let c=20*Math.max(.3,1-this.getD3D(this.me.x,this.me.y,this.me.z,h.x,h.y,h.z)/600)>=1&&this.containsPoint(h);if(this.me.weapon[this.vars.nAuto]&&this.me[this.vars.didShoot])t[this.key.shoot]=0,t[this.key.scope]=0,this.me.inspecting=!1,this.me.inspectX=0;else if(!c&&this.settings.frustrumCheck.val)this.resetLookAt();else if(i||s)switch(this.settings.autoAim.val){case"quickScope":t[this.key.scope]=!c&&this.settings.frustrumCheck.val?0:1,this.me[this.vars.aimVal]&&!this.me.weapon.noAim||(this.me.canThrow&&s||(this.lookDir(r,o),t[this.key.shoot]=1),t[this.key.ydir]=o,t[this.key.xdir]=r);break;case"assist":case"easyassist":(t[this.key.scope]||"easyassist"===this.settings.autoAim.val)&&(!this.me.aimDir&&c||"easyassist"===this.settings.autoAim.val)&&(this.me.canThrow&&s||this.lookDir(r,o),"easyassist"===this.settings.autoAim.val&&this.controls[this.vars.mouseDownR]&&(t[this.key.scope]=1),t[this.key.ydir]=o,t[this.key.xdir]=r);break;case"silent":t[this.key.scope]=!c&&this.settings.frustrumCheck.val?0:1,!this.me[this.vars.aimVal]||this.me.weapon.noAim?this.me.canThrow&&s||(t[this.key.shoot]=1):t[this.key.scope]=1,t[this.key.ydir]=o,t[this.key.xdir]=r;break;case"trigger":t[this.key.scope]&&l&&(t[this.key.shoot]=1,t[this.key.ydir]=o,t[this.key.xdir]=r);break;case"correction":1==t[this.key.shoot]&&(t[this.key.ydir]=o,t[this.key.xdir]=r);break;default:this.resetLookAt()}}else this.resetLookAt()}return t}onRender(){let t=this.ctx.canvas.width/this.scale,s=this.ctx.canvas.height/this.scale,n=(2*this.consts.armScale+this.consts.chestWidth+this.consts.armInset)/2,o=this.renderer.camera[this.vars.getWorldPosition](),r=this.settings.renderESP.val;for(let l=0,h=this.game.players.list.length;l<h;l++){let h=this.game.players.list[l];if(!h||h[this.vars.isYou]||!h.active||!e.isDefined(h[this.vars.objInstances]))continue;let c=!this.me.team||this.me.team!=h.team,d=h.isDev||h.isMod||h.isMapMod||h.canGlobalKick||h.canViewReports||h.partnerApp||h.canVerify||h.canTeleport||h.kpdData||h.fakeName||h.level>=100;h[this.vars.objInstances].visible?h[this.vars.objInstances].traverse((t=>{t&&"Mesh"==t.type&&t.hasOwnProperty("material")&&(t.hasOwnProperty("_material")?Object.defineProperty(t,"material",{get(){return e.isDefined(a.mesh)&&a.settings.renderChams.val?a.mesh[c?d?"#FFFF00":a.settings.rainbowColor.val?a.overlay.rainbow.col:a.settings.chamHostileCol.val||"#ff0000":a.settings.chamFriendlyCol.val||"#00ff00"]:this._material},set(t){return this._material}}):t._material=t.material,t.material.wireframe=!!a.settings.renderWireFrame.val)})):Object.defineProperty(h[this.vars.objInstances],"visible",{value:!0,writable:!1});let m=1/0,u=-1/0,p=1/0,g=-1/0,f=null,w=!1;for(let t=-1;!w&&t<2;t+=2)for(let e=-1;!w&&e<2;e+=2)for(let s=0;!w&&s<2;s++)if(f=h[this.vars.objInstances].position.clone()){if(f.x+=t*n,f.z+=e*n,f.y+=s*(h.height-h[this.vars.crouchVal]*this.consts.crouchDst),!this.containsPoint(f)){w=!0;break}f.project(this.renderer.camera),m=Math.min(m,f.x),u=Math.max(u,f.x),p=Math.min(p,f.y),g=Math.max(g,f.y)}if(w)continue;m=(m+1)/2,p=(p+1)/2,u=(u+1)/2,g=(g+1)/2;const y=this.ctx.strokeStyle,x=this.ctx.lineWidth,v=this.ctx.font,b=this.ctx.fillStyle;if(this.settings.renderTracers.val){i.save.apply(this.ctx,[]);let t=this.world2Screen(h[this.vars.objInstances].position);this.ctx.lineWidth=1,this.ctx.beginPath(),this.ctx.moveTo(this.ctx.canvas.width/2,this.ctx.canvas.height-(this.ctx.canvas.height-s)),this.ctx.lineTo(t.x,t.y),this.ctx.strokeStyle="rgba(0, 0, 0, 0.25)",this.ctx.stroke(),this.ctx.lineWidth=1,this.ctx.strokeStyle=c?d?"#FFFF00":a.settings.espHostileCol.val||"#ff0000":a.settings.espFriendlyCol.val||"#00ff00",this.ctx.stroke(),i.restore.apply(this.ctx,[])}if(i.save.apply(this.ctx,[]),"twoD"==r||"full"==r){this.ctx.lineWidth=5,this.ctx.strokeStyle=c?d?"#FFFF00":a.settings.espHostileCol.val||"#ff0000":a.settings.espFriendlyCol.val||"#00ff00";let e=Math.max(.3,1-this.getD3D(o.x,o.y,o.z,h.x,h.y,h.z)/600);i.scale.apply(this.ctx,[e,e]);let n=t/e,l=s/e;if(i.beginPath.apply(this.ctx,[]),p=l*(1-p),g=l*(1-g),m*=n,u*=n,i.moveTo.apply(this.ctx,[m,p]),i.lineTo.apply(this.ctx,[m,g]),i.lineTo.apply(this.ctx,[u,g]),i.lineTo.apply(this.ctx,[u,p]),i.lineTo.apply(this.ctx,[m,p]),i.stroke.apply(this.ctx,[]),"full"==r){this.ctx.fillStyle="#000000";let t=g-p;i.fillRect.apply(this.ctx,[m-7,p,-10,t]),this.ctx.fillStyle=h.health>75?"green":h.health>40?"orange":"red",i.fillRect.apply(this.ctx,[m-7,p,-10,t*(h.health/h[this.vars.maxHealth])]),this.ctx.font="Bold 48px Tahoma",this.ctx.fillStyle="white",this.ctx.strokeStyle="black",this.ctx.lineWidth=1;let e=u+7,s=g;i.fillText.apply(this.ctx,[h.name||h.alias,e,s]),i.strokeText.apply(this.ctx,[h.name||h.alias,e,s]),this.ctx.font="Bold 30px Tahoma",this.ctx.fillStyle="#cccccc",s+=35,i.fillText.apply(this.ctx,[h.weapon.name,e,s]),i.strokeText.apply(this.ctx,[h.weapon.name,e,s]),s+=35,this.ctx.fillStyle=h.health>75?"green":h.health>40?"orange":"red",i.fillText.apply(this.ctx,[h.health+" HP",e,s]),i.strokeText.apply(this.ctx,[h.health+" HP",e,s])}}i.restore.apply(this.ctx,[]),this.ctx.strokeStyle=y,this.ctx.lineWidth=x,this.ctx.font=v,this.ctx.fillStyle=b}if("off"!==this.settings.fovBoxSize.val){let e=null;switch(this.settings.fovBoxSize.val){case"large":e=[t/3,s/4,t*(1/3),s/2];break;case"medium":e=[.4*t,s/3,.2*t,s/3];break;case"small":e=[.45*t,.4*s,.1*t,.2*s]}i.save.apply(this.ctx,[]),this.ctx.strokeStyle="red",this.ctx.strokeRect(...e),i.restore.apply(this.ctx,[])}}createSettings(){this.settings={renderESP:{tab:"Render",name:"Player ESP Type",val:"off",html:()=>this.generateSetting("select","renderESP",{off:"Off",walls:"Walls",twoD:"2d",full:"Full"}),set:t=>{this.nameTags="off"!=t||void 0,this.noNameTags="full"==t||void 0}},renderTracers:{tab:"Render",name:"Player Tracers",val:!1,html:()=>this.generateSetting("checkbox","renderTracers")},espHostileCol:{tab:"Render",name:"Hostile Color",val:"#ff0000",html:()=>this.generateSetting("color","espHostileCol")},espFriendlyCol:{tab:"Render",name:"Friendly Color",val:"#00ff00",html:()=>this.generateSetting("color","espFriendlyCol")},renderChams:{tab:"Render",pre:"<div class='separator'>Color Chams</div>",name:"Player Chams",val:!1,html:()=>this.generateSetting("checkbox","renderChams")},renderWireFrame:{tab:"Render",name:"Player Wireframe",val:!1,html:()=>this.generateSetting("checkbox","renderWireFrame")},rainbowColor:{tab:"Render",name:"Rainbow Color",val:!1,html:()=>this.generateSetting("checkbox","rainbowColor")},chamHostileCol:{tab:"Render",name:"Hostile Color",val:"#ff0000",html:()=>this.generateSetting("color","chamHostileCol")},chamFriendlyCol:{tab:"Render",name:"Friendly Color",val:"#00ff00",html:()=>this.generateSetting("color","chamFriendlyCol")},hideAdverts:{tab:"Render",pre:"<div class='separator'>Krunker UI</div>",name:"Hide Advertisments",val:!0,html:()=>this.generateSetting("checkbox","hideAdverts"),set:(t,e)=>{t?this.mainCustomRule("insert",this.css.hideAdverts):e||this.mainCustomRule("delete",this.css.hideAdverts)}},hideStreams:{tab:"Render",name:"Hide Streams",val:!1,html:()=>this.generateSetting("checkbox","hideStreams"),set:t=>{this.displayStyle("streamContainer",t)}},hideMerch:{tab:"Render",name:"Hide Merch",val:!1,html:()=>this.generateSetting("checkbox","hideMerch"),set:t=>{this.displayStyle("merchHolder",t)}},hideNewsConsole:{tab:"Render",name:"Hide News Console",val:!1,html:()=>this.generateSetting("checkbox","hideNewsConsole"),set:t=>{this.displayStyle("newsHolder",t)}},hideCookieButton:{tab:"Render",name:"Hide Security Manage Button",val:!1,html:()=>this.generateSetting("checkbox","hideCookieButton"),set:t=>{this.displayStyle("onetrust-consent-sdk",t)}},showSkidBtn:{tab:"Render",pre:"<hr>",name:"Show Menu Button",val:!0,html:()=>this.generateSetting("checkbox","showSkidBtn"),set:(t,s)=>{let i=document.getElementById("mainButton");e.isDefined(i)||e.createButton("Junk","https://i.imgur.com/pA5e8hy.png",this.toggleMenu,t),e.waitFor((()=>document.getElementById("mainButton"))).then((e=>{e.style.display=t?"inherit":"none"}))}},customCSS:{tab:"Render",pre:"<hr>",name:"Custom CSS",val:"",html:()=>this.generateSetting("url","customCSS","URL to CSS file"),css:document.createElement("link"),set:(t,e)=>{if(t&&t.startsWith("http")&&t.endsWith(".css")?this.settings.customCSS.css.href=t:this.settings.customCSS.css.href=null,e&&this.settings.customCSS.css){this.settings.customCSS.css.rel="stylesheet";try{document.getElementsByTagName("head")[0].appendChild(this.settings.customCSS.css)}catch(t){console.error(t),this.settings.customCSS.css=null}}}},customBillboard:{tab:"Render",name:"Custom Billboard Text",val:"",html:()=>this.generateSetting("text","customBillboard","Custom Billboard Text")},autoReload:{tab:"Weapon",name:"Auto Reload",val:!1,html:()=>this.generateSetting("checkbox","autoReload")},weaponZoom:{tab:"Weapon",name:"Weapon Zoom",val:1,min:0,max:50,step:.01,html:()=>this.generateSetting("slider","weaponZoom"),set:t=>e.waitFor((()=>this.renderer)).then((e=>{e.adsFovMlt=t}))},weaponTrails:{tab:"Weapon",name:"Weapon Trails",val:!1,html:()=>this.generateSetting("checkbox","weaponTrails"),set:t=>e.waitFor((()=>this.me)).then((e=>{e.weapon.trail=t}))},autoAim:{tab:"Weapon",pre:"<div class='separator'>Auto Aim</div>",name:"Auto Aim Type",val:"off",html:()=>this.generateSetting("select","autoAim",{off:"Off",correction:"Aim Correction",assist:"Legit Aim Assist",easyassist:"Easy Aim Assist",silent:"Silent Aim",trigger:"Trigger Bot",quickScope:"Quick Scope"})},fovBoxSize:{tab:"Weapon",name:"FOV Box Type",val:"off",html:()=>this.generateSetting("select","fovBoxSize",{off:"Off",small:"Small",medium:"Medium",large:"Large"})},aimOffset:{tab:"Weapon",name:"Aim Offset",val:0,min:-4,max:1,step:.01,html:()=>this.generateSetting("slider","aimOffset"),set:t=>{this.settings.playStream.audio&&(this.settings.playStream.audio.volume=t)}},frustrumCheck:{tab:"Weapon",name:"Player Visible Check",val:!1,html:()=>this.generateSetting("checkbox","frustrumCheck")},wallPenetrate:{tab:"Weapon",name:"Aim through Penetratables",val:!1,html:()=>this.generateSetting("checkbox","wallPenetrate")},autoBhop:{tab:"Player",name:"Auto Bhop Type",val:"off",html:()=>this.generateSetting("select","autoBhop",{off:"Off",autoJump:"Auto Jump",keyJump:"Key Jump",autoSlide:"Auto Slide",keySlide:"Key Slide"})},skinUnlock:{tab:"Player",name:"Unlock Skins",val:!1,html:()=>this.generateSetting("checkbox","skinUnlock")},autoActivateNuke:{tab:"GamePlay",name:"Auto Activate Nuke",val:!1,html:()=>this.generateSetting("checkbox","autoActivateNuke")},autoFindNew:{tab:"GamePlay",name:"New Lobby Finder",val:!1,html:()=>this.generateSetting("checkbox","autoFindNew")},autoClick:{tab:"GamePlay",name:"Auto Start Game",val:!1,html:()=>this.generateSetting("checkbox","autoClick")},noInActivity:{tab:"GamePlay",name:"No InActivity Kick",val:!0,html:()=>this.generateSetting("checkbox","noInActivity")},playStream:{tab:"Radio",name:"Stream Select",val:"off",html:()=>this.generateSetting("select","playStream",{off:"Off",_2000s:"General German/English",_HipHopRNB:"Hip Hop / RNB",_Oldskool:"Hip Hop Oldskool",_Country:"Country",_Pop:"Pop",_Dance:"Dance",_Dubstep:"DubStep",_Lowfi:"LoFi HipHop",_Jazz:"Jazz",_Oldies:"Golden Oldies",_Club:"Club",_Folk:"Folk",_ClassicRock:"Classic Rock",_Metal:"Heavy Metal",_DeathMetal:"Death Metal",_Classical:"Classical",_Alternative:"Alternative"}),set:t=>{if("off"==t)return void(this.settings.playStream.audio&&(this.settings.playStream.audio.pause(),this.settings.playStream.audio.currentTime=0,this.settings.playStream.audio=null));let e=this.settings.playStream.urls[t];this.settings.playStream.audio?this.settings.playStream.audio.src=e:(this.settings.playStream.audio=new Audio(e),this.settings.playStream.audio.volume=this.settings.audioVolume.val||.5),this.settings.playStream.audio.load(),this.settings.playStream.audio.play()},urls:{_2000s:"http://0n-2000s.radionetz.de/0n-2000s.aac",_HipHopRNB:"https://stream-mixtape-geo.ntslive.net/mixtape2",_Country:"https://live.wostreaming.net/direct/wboc-waaifmmp3-ibc2",_Dance:"http://streaming.radionomy.com/A-RADIO-TOP-40",_Pop:"http://bigrradio.cdnstream1.com/5106_128",_Jazz:"http://strm112.1.fm/ajazz_mobile_mp3",_Oldies:"http://strm112.1.fm/60s_70s_mobile_mp3",_Club:"http://strm112.1.fm/club_mobile_mp3",_Folk:"https://freshgrass.streamguys1.com/irish-128mp3",_ClassicRock:"http://1a-classicrock.radionetz.de/1a-classicrock.mp3",_Metal:"http://streams.radiobob.de/metalcore/mp3-192",_DeathMetal:"http://stream.laut.fm/beatdownx",_Classical:"http://live-radio01.mediahubaustralia.com/FM2W/aac/",_Alternative:"http://bigrradio.cdnstream1.com/5187_128",_Dubstep:"http://streaming.radionomy.com/R1Dubstep?lang=en",_Lowfi:"http://streams.fluxfm.de/Chillhop/mp3-256",_Oldskool:"http://streams.90s90s.de/hiphop/mp3-128/"},audio:null},audioVolume:{tab:"Radio",name:"Radio Volume",val:.5,min:0,max:1,step:.01,html:()=>this.generateSetting("slider","audioVolume"),set:t=>{this.settings.playStream.audio&&(this.settings.playStream.audio.volume=t)}},saveGameJsBtn:{tab:"Dev",name:"Save Game Script",val:!1,html:()=>this.generateSetting("button","saveGameJsBtn",{label:"Save",function:`${this.hash}.globalCMD('save gameJS')`})}},e.waitFor((()=>window.windows)).then((()=>{let t=window.windows[11];t.html="",t.header=e.genHash(8),t.gen=()=>{let t=`<div class='wrapper'><div class="content"><div class="guild-icon" style="background-image: url(&quot;https://cdn.discordapp.com/icons/${this.discord.guild.id}/${this.discord.guild.icon}.webp?size=64&quot;);"></div><div class="guild-info" style="flex: 1 1 auto;"><div class="guild-name"> <a href="https://e9x.github.io/kru/inv">${this.discord.guild.name}</a> &nbsp;&nbsp;&nbsp;<div class="colorStandard size14 guildDetail"><div class="statusCounts"><i class="statusOnline status"></i><span class="count-30T-5k online-count">${this.discord.approximate_presence_count} Online</span>&nbsp;<i class="statusOffline status"></i><span class="count-30T-5k offline-count">${this.discord.approximate_member_count} Members</span></div></div></div></div><button type="button" class="d-button join-button" onmouseenter="playTick()" onclick="window.location.href='https://discord.com/invite/${this.discord.code}'"><div class="d-button-label">Join</div></button></div></div>`;return t+='<div class="tab">',this.tabs.forEach((e=>{t+=`<button class="tablinks" onclick="${this.hash}.tabChange(event, '${e}')">${e}</button>`})),t+="</div>",this.tabs.forEach((e=>{t+=`<div id="${e}" class="tabcontent"> ${this.tabContent(e)} </div>`})),t};for(const t in this.settings)if(this.settings[t].def=this.settings[t].val,!this.settings[t].disabled){let e=this.getSavedVal(t);this.settings[t].val=null!==e?e:this.settings[t].val,this.settings[t].val=this.settings[t].val,"false"==this.settings[t].val&&(this.settings[t].val=!1),"true"==this.settings[t].val&&(this.settings[t].val=!0),"undefined"==this.settings[t].val&&(this.settings[t].val=this.settings[t].def),this.settings[t].set&&this.settings[t].set(this.settings[t].val,!0)}}))}toggleMenu(){(document.pointerLockElement||document.mozPointerLockElement)&&document.exitPointerLock(),window.showWindow(12),e.isDefined(window.SOUND)&&window.SOUND.play("tick_0",.1)}tabChange(t,e){var s,i,a;for(i=document.getElementsByClassName("tabcontent"),s=0;s<i.length;s++)i[s].style.display="none";for(a=document.getElementsByClassName("tablinks"),s=0;s<a.length;s++)a[s].className=a[s].className.replace(" active","");document.getElementById(e).style.display="block",t.currentTarget.className+=" active"}tabContent(t){let e="";for(let s in this.settings)this.settings[s].tab==t&&(this.settings[s].pre&&(e+=this.settings[s].pre),e+="<div class='settName' id='"+s+"_div' style='display:block'>"+this.settings[s].name+" "+this.settings[s].html()+"</div>");return e}globalCMD(t){if(confirm(t))switch(t){case"save gameJS":return e.saveData("game_"+this.vars.version+".js",this.gameJS)}}generateSetting(t,e,s){switch(t){case"button":return`<input type="button" name="${t}" id="slid_utilities_${e}" class="settingsBtn" onclick="${s.function}" value="${s.label}" style="float:right;width:auto"/>`;case"checkbox":return`<label class="switch"><input type="checkbox" onclick="${this.hash}.setSetting('${e}', this.checked)" ${this.settings[e].val?"checked":""}><span class="slider"></span></label>`;case"slider":return`<span class='sliderVal' id='slid_utilities_${e}'>${this.settings[e].val}</span><div class='slidecontainer'><input type='range' min='${this.settings[e].min}' max='${this.settings[e].max}' step='${this.settings[e].step}' value='${this.settings[e].val}' class='sliderM' oninput="${this.hash}.setSetting('${e}', this.value)"></div>`;case"select":{let t=`<select onchange="${this.hash}.setSetting('${e}', this.value)" class="inputGrey2">`;for(let i in s)t+='<option value="'+i+'" '+(i==this.settings[e].val?"selected":"")+">"+s[i]+"</option>";return t+="</select>",t}default:return`<input type="${t}" name="${t}" id="slid_utilities_${e}"\n${"color"==t?'style="float:right;margin-top:5px"':`class="inputGrey2" placeholder="${s}"`}\nvalue="${this.settings[e].val}" oninput="${this.hash}.setSetting('${e}', this.value)"/>`}}setSetting(t,e){this.settings[t].val=e,this.saveVal(t,e),document.getElementById(`slid_utilities_${t}`)&&(document.getElementById(`slid_utilities_${t}`).innerHTML=e),this.settings[t].set&&this.settings[t].set(e)}saveVal(t,e){localStorage.setItem("krk_"+t,e)}deleteVal(t){localStorage.removeItem("krk_"+t)}getSavedVal(t){return localStorage.getItem("krk_"+t)}gameHooks(){e.waitFor((()=>this.exports)).then((t=>{let s={overlay:["render","canvas"],config:["accAnnounce","availableRegions","assetCat"],three:["ACESFilmicToneMapping","TextureLoader","ObjectLoader"]};for(let i in t){let a=t[i].exports;for(let t in s)e.objectHas(a,s[t])&&(console.info("Found Export ",t),delete s[t],this[t]=a)}if(0!==Object.keys(s).length||s.constructor!==Object)for(let t in s)alert("Failed To Find Export "+t);else{function i(t,s,i,n,o){a.overlay.canvas.width,a.overlay.canvas.height;const r=[t,s,i,n,o];r&&(i&&"object"==typeof a.settings&&a.settings.noInActivity.val&&(i.idleTimer=0,e.isDefined(a.config)&&(a.config.kickTimer=1/0)),o&&(o.active&&o.health&&i.update(),o.banned&&Object.assign(o,{banned:!1}),o.isHacker&&Object.assign(o,{isHacker:0}),o.kicked&&Object.assign(o,{kicked:!1}),o.kickedByVote&&Object.assign(o,{kickedByVote:!1}),o.account=Object.assign(o,{premiumT:!0}),["scale","game","controls","renderer","me"].forEach(((t,e)=>{a[t]=r[e]})),a.ctx.save(),a.ctx.scale(t,t),a.onRender(),a.ctx.restore()),e.isType(a.settings,"object")&&(a.settings.hasOwnProperty("autoActivateNuke")&&a.settings.autoActivateNuke.val&&a.me&&Object.keys(a.me.streaks).length&&a.wsSend("k",0),a.settings.hasOwnProperty("autoClick")&&a.settings.autoClick.val&&"none"==window.endUI.style.display&&"none"==window.windowHolder.style.display&&i.toggle(!0)))}Object.defineProperties(this.config,{nameVisRate:{value:0,writable:!1},serverTickFrequency:{value:60,writable:!1},syncRate:{value:0,writable:!1},hitBoxPad:{value:0,writable:!1}}),this.ray=new this.three.Raycaster,this.vec2=new this.three.Vector2(0,0),this.mesh=new Proxy({},{get:(t,e)=>(t[e]||(t[e]=new a.three.MeshBasicMaterial({transparent:!0,fog:!1,depthTest:!1,color:e})),t[e])}),this.ctx=this.overlay.canvas.getContext("2d"),this.overlay.render=new Proxy(this.overlay.render,{apply:function(t,e,s){return[t.apply(e,s),i.apply(e,s)]}})}}));const t=Symbol("origSkins"),s=Symbol("localSkins");Object.defineProperties(Object.prototype,{skins:{set(e){return this[t]=e,null!=this[s]&&this[s].length||(this[s]=Array.apply(null,Array(5e3)).map(((t,e)=>({ind:e,cnt:1})))),e},get(){return a.settings.skinUnlock.val&&this.stats?this[s]:this[t]}}}),e.waitFor((()=>this.ws)).then((()=>{this.wsEvent=this.ws._dispatchEvent.bind(this.ws),this.wsSend=this.ws.send.bind(this.ws),this.ws.send=new Proxy(this.ws.send,{apply:function(t,e,[s,...i]){if("ah2"!=s){if("en"==s){let t=i[0];t&&(a.skinData=Object.assign({},{main:t[2][0],secondary:t[2][1],hat:t[3],body:t[4],knife:t[9],dye:t[14],waist:t[17]}))}return t.apply(e,[s,...i])}}}),this.ws._dispatchEvent=new Proxy(this.ws._dispatchEvent,{apply:function(t,e,[s,...i]){if("init"==s){let t=i[0];t[10]&&t[10].bill&&a.settings&&a.settings.customBillboard.val.length>1&&(t[10].bill.txt=a.settings.customBillboard.val)}if("0"==s){let t=i[0][0],e=39;for(;t.length%e!=0;)e++;for(let s=0;s<t.length;s+=e)t[s]===a.ws.socketId&&(t[s+12]=[a.skinData.main,a.skinData.secondary],t[s+13]=a.skinData.hat,t[s+14]=a.skinData.body,t[s+19]=a.skinData.knife,t[s+24]=a.skinData.dye,t[s+33]=a.skinData.waist)}return"3"==s&&i[0][4]&&(i[0][4].wId=0,i[0][4].hs=!0,i[0][4].dst=1/0,i[0][4].wb=!0),t.apply(e,[s,...i])}})}))}gameLoad(){this.vars=e.getData(this.gameJS,{version:{regex:/exports\.gameVersion='(\d+\.\d+\.\d+)',/,index:1},inView:{regex:/&&!\w\.\w+&&\w\.\w+&&\w\.(\w+)\){/,index:1},spectating:{regex:/team:window\.(\w+)/,index:1},procInputs:{regex:/this\.(\w+)=function\(\w+,\w+,\w+,\w+\){this\.recon/,index:1},aimVal:{regex:/this\.(\w+)-=1\/\(this\.weapon\.aimSpd/,index:1},pchObjc:{regex:/0,this\.(\w+)=new \w+\.Object3D,this/,index:1},didShoot:{regex:/--,\w+\.(\w+)=!0/,index:1},nAuto:{regex:/'Single Fire',varN:'(\w+)'/,index:1},crouchVal:{regex:/this\.(\w+)\+=\w\.crouchSpd\*\w+,1<=this\.\w+/,index:1},recoilAnimY:{regex:/\.\w+=0,this\.(\w+)=0,this\.\w+=0,this\.\w+=1,this\.slide/,index:1},ammos:{regex:/length;for\(\w+=0;\w+<\w+\.(\w+)\.length/,index:1},weaponIndex:{regex:/\.weaponConfig\[\w+]\.secondary&&\(\w+\.(\w+)==\w+/,index:1},isYou:{regex:/this\.accid=0,this\.(\w+)=\w+,this\.isPlayer/,index:1},objInstances:{regex:/\w+\.\w+\(0,0,0\);if\(\w+\.(\w+)=\w+\.\w+/,index:1},getWorldPosition:{regex:/var \w+=\w+\.camera\.(\w+)\(\);/,index:1},mouseDownR:{regex:/this\.(\w+)=0,this\.keys=/,index:1},maxHealth:{regex:/\.regenDelay,this\.(\w+)=\w+\.mode&&\w+\.mode\.\1/,index:1},xDire:{regex:/this\.(\w+)=Math\.lerpAngle\(this\.xDir2/,index:1},yDire:{regex:/this\.(\w+)=Math\.lerpAngle\(this\.yDir2/,index:1},yVel:{regex:/this\.(\w+)=this\.\w+,this\.visible/,index:1}}),new Function("WP_fetchMMToken","Module",this.hash,e.patchData(this.gameJS,{exports:{regex:/(this\.\w+\.\w+\(this\)}},function\(\w+,\w+,(\w+)\){)/,patch:`$1 ${this.hash}.exports=$2.c; ${this.hash}.modules=$2.m;`},inputs:{regex:/(\w+\.\w+\.\w+\?'\w+':'push'\]\()(\w+)\),/,patch:`$1${this.hash}.onInput($2)),`},inView:{regex:/&&(\w+\.\w+)\){(if\(\(\w+=\w+\.\w+\.\w+\.\w+)/,patch:`){if(void 0!==${this.hash}.noNameTags||!$1&&void 0 == ${this.hash}.nameTags)continue;$2`},socket:{regex:/this\.\w+=new WebSocket\(\w+\)/,patch:`${this.hash}.ws=this;$&`},isHacker:{regex:/(window\.\w+=)!0\)/,patch:"$1!1)"},respawnT:{regex:/\w+:1e3\*/g,patch:"respawnT:0*"},anticheat1:{regex:/&&\w+\(\),window\.utilities&&\(\w+\(null,null,null,!0\),\w+\(\)\)/,patch:""},anticheat3:{regex:/windows\.length>\d+.*?37/,patch:"37"},commandline:{regex:/Object\.defineProperty\(console.*?\),/,patch:""}}))(new Promise((t=>t(this.token))),{csv:async()=>0},this)}mainCustomRule(t,s){e.waitFor((()=>this.mainCustom)).then((()=>{const e=this.mainCustom.cssRules;if("insert"==t)this.mainCustom.insertRule(s);else if("delete"==t)for(let t=0;t<e.length;t++)e[t].cssText==s&&this.mainCustom.deleteRule(t);else console.error(t+" not Implemented for mainCustomRule")}))}displayStyle(t,s){e.waitFor((()=>window[t]),5e3).then((e=>{e?e.style.display=s?"none":"inherit":log.error(t," was not found in the window object")}))}stylesheets(){new Array(...document.styleSheets).map((t=>{if(t.href){let e=/http.*?krunker.io\/css\/(\w+.css).+/.exec(t.href);if(e&&e[1]){let s=e[1];s&&s.includes("main_custom")&&(this.mainCustom=t)}}}));let t=document.createElement("style");t.type="text/css",e.head.appendChild(t),Object.entries({tabStyle:".tab { overflow: hidden; border: 1px solid #ccc; background-image: linear-gradient(#2f3136, #f1f1f1, #2f3136); }",btnStyle:".tab button { background-color: inherit; float: left; border: none; outline: solid; cursor: pointer; padding: 14px 16px; transition: 0.3s; font-size: 17px; font-weight:500;color:black;text-shadow: 2px 2px #FFF;}",btnHoverStyle:".tab button:hover { background-color: #ddd; }",activeTabStyle:".tab button.active { background-color: #ccc; }",tabContentStyle:".tabcontent { display: none; padding: 6px 12px; border: 1px solid #ccc; border-top: none; animation: fadeEffect 1s; /* Fading effect takes 1 second */}",zeroToFullOpacity:"@keyframes fadeEffect { from {opacity: 0;} to {opacity: 1;} }",separator:".separator{display:flex;align-items:center;text-align:center}.separator::before,.separator::after{content:'';flex:1;border-bottom:1px solid #000}.separator:not(:empty)::before{margin-right:.25em}.separator:not(:empty)::after{margin-left:.25em}",discordWrapper:".wrapper{background:#2f3136;width:100%;}",discordContent:".content{display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;flex-flow:row nowrap}",discordInfo:".guild-info{flex:1 1 auto;min-width:1px;-webkit-box-orient:vertical;-webkit-box-direction:normal;flex-direction:column;flex-wrap:nowrap;display:flex;align-items:stretch;-webkit-box-align:stretch;justify-content:center;text-indent:0}",discordIcon:".guild-icon{background-color:#333;margin-right:16px;flex:0 0 auto;width:50px;height:50px;border-radius:15px;position:relative;background-clip:padding-box;background-position:50%;background-size:100% 100%}",discordDesc:".inv-desc{font-weight:700;margin:0;margin-bottom:12px;white-space:nowrap;text-overflow:ellipsis;overflow:hidden;color:#b9bbbe;text-transform:uppercase;font-size:12px;line-height:12px;flex:1}",discordName:".guild-name{flex:1 1 auto;min-width:0;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;line-height:20px;align-items:center;display:flex;color:#FFF;font-weight:700}",discordNameHover:".guild-name:hover{cursor:pointer;text-decoration:underline}",discordBtn:".d-button{align-self:center;margin-left:10px;margin-top:4px;white-space:nowrap;flex:0 0 auto;position:relative;display:flex;justify-content:center;align-items:center;border-radius:3px;border:none;font-size:14px;font-weight:500;line-height:20px;height:43px;padding:2px 20px;user-select:none;transition:background-color .1s ease,color .1s ease;color:#FFF;background:#4B8;cursor:pointer}",discordBtnHover:".d-button:hover{background:#3A7;}",discordBtnLabel:".d-button-label{font-weight:500;color:white;text-shadow: 2px 2px #000;}",discordActive:".d-button:active{background:#396}",discordInvDest:".inviteDestination{margin:0}",discordDetail:".guildDetail{margin:0;font-size:14px;white-space:nowrap;text-overflow:ellipsis;overflow:hidden;color:#b9bbbe;line-height:16px}",discordStatusCounts:".statusCounts{display:flex;-webkit-box-align:center;align-items:center;font-weight:600}",discordStatus:".status{display:block;margin-right:4px;width:8px;height:8px;border-radius:50%;flex:0 0 auto;font-style:italic}",discordStatusOnline:".statusOnline{background:#43b581}",discordStatusOffline:".statusOffline{background:#747f8d}",discordCount:".count-30T-5k{-webkit-box-flex:0;flex:0 1 auto;margin-right:8px;color:#b9bbbe;white-space:nowrap;text-overflow:ellipsis;overflow:hidden}"}).forEach((([e,s],i)=>{t.appendChild(document.createTextNode(s))}))}eventHandlers(){window.addEventListener("load",(t=>{console.log("page is fully loaded"),this.stylesheets(),e.waitFor((()=>document.querySelector("#instructionsUpdate")),5e3).then((t=>{if(!t)return console.error("Could not get instructions update");e.createObserver(t,"style",(t=>{this.settings.autoFindNew.val&&["Kicked","Banned","Disconnected","Error","Game is full"].some((e=>t&&t.innerHTML.includes(e)))&&(location=document.location.origin)}))})),window.addEventListener("keyup",(t=>{this.downKeys.has(t.code)&&this.downKeys.delete(t.code)})),window.addEventListener("keydown",(t=>{if("INPUT"!=document.activeElement.tagName)switch(t.code){case"F1":t.preventDefault(),this.toggleMenu();break;case"NumpadSubtract":document.exitPointerLock(),console.dir(window),console.dir(this);break;default:this.downKeys.has(t.code)||this.downKeys.add(t.code)}}))}))}getD3D(t,e,s,i,a,n){let o=t-i,r=e-a,l=s-n;return Math.sqrt(o*o+r*r+l*l)}getAngleDst(t,e){return Math.atan2(Math.sin(e-t),Math.cos(t-e))}getXDire(t,e,s,i,a,n){let o=Math.abs(e-a),r=this.getD3D(t,e,s,i,a,n);return Math.asin(o/r)*(e>a?-1:1)}getDir(t,e,s,i){return Math.atan2(e-i,t-s)}getDistance(t,e,s,i){return Math.sqrt((s-=t)*s+(i-=e)*i)}containsPoint(t){let e=this.renderer.frustum.planes;for(let s=0;s<6;s++)if(e[s].distanceToPoint(t)<0)return!1;return!0}getCanSee(t,e,s,i,a){if(!t)return 0;a=a||0;for(let n,o=this.getD3D(t.x,t.y,t.z,e,s,i),r=this.getDir(t.z,t.x,i,e),l=this.getDir(this.getDistance(t.x,t.z,e,i),s,0,t.y),h=1/(o*Math.sin(r-Math.PI)*Math.cos(l)),c=1/(o*Math.cos(r-Math.PI)*Math.cos(l)),d=1/(o*Math.sin(l)),m=t.y+(t.height||0)-this.consts.cameraHeight,u=0;u<this.game.map.manager.objects.length;++u)if(!(n=this.game.map.manager.objects[u]).noShoot&&n.active&&!n.transparent&&(!this.settings.wallPenetrate.val||!n.penetrable||!this.me.weapon.pierce)){let e=this.lineInRect(t.x,t.z,m,h,c,d,n.x-Math.max(0,n.width-a),n.z-Math.max(0,n.length-a),n.y-Math.max(0,n.height-a),n.x+Math.max(0,n.width-a),n.z+Math.max(0,n.length-a),n.y+Math.max(0,n.height-a));if(e&&1>e)return e}return null}lineInRect(t,e,s,i,a,n,o,r,l,h,c,d){let m=(o-t)*i,u=(h-t)*i,p=(l-s)*n,g=(d-s)*n,f=(r-e)*a,w=(c-e)*a,y=Math.max(Math.max(Math.min(m,u),Math.min(p,g)),Math.min(f,w)),x=Math.min(Math.min(Math.max(m,u),Math.max(p,g)),Math.max(f,w));return!(x<0)&&!(y>x)&&y}lookDir(t,e){t/=1e3,e/=1e3,this.controls.object.rotation.y=e,this.controls[this.vars.pchObjc].rotation.x=t,this.controls[this.vars.pchObjc].rotation.x=Math.max(-this.consts.halfPI,Math.min(this.consts.halfPI,this.controls[this.vars.pchObjc].rotation.x)),this.controls.yDr=(this.controls[this.vars.pchObjc].rotation.x%Math.PI).round(3),this.controls.xDr=(this.controls.object.rotation.y%Math.PI).round(3),this.renderer.camera.updateProjectionMatrix(),this.renderer.updateFrustum()}resetLookAt(){this.controls.yDr=this.controls[this.vars.pchObjc].rotation.x,this.controls.xDr=this.controls.object.rotation.y,this.renderer.camera.updateProjectionMatrix(),this.renderer.updateFrustum()}world2Screen(t){let e=t.clone(),s=this.ctx.canvas.width/this.scale,i=this.ctx.canvas.height/this.scale;return e.project(this.renderer.camera),e.x=(e.x+1)/2,e.y=(1-e.y)/2,e.x*=s,e.y*=i,e}getInView(t){return null==this.getCanSee(this.me,t.x,t.y,t.z)}getIsFriendly(t){return(this.me&&this.me.team?this.me.team:this.me.spectating?1:0)==t.team}};t.init(a).source().then((e=>{a.gameJS=e,t.token().then((t=>{a.token=t}))}));let n=new MutationObserver((t=>{for(let e of t)for(let t of e.addedNodes)"SCRIPT"===t.tagName&&("text/javascript"===t.type&&t.innerHTML.startsWith("*!",1)?(t.innerHTML="window._debugTimeStart=Date.now()",n.disconnect()):t.src)}));n.observe(document,{childList:!0,subtree:!0})})()})();